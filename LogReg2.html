<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>logreg2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="LogReg2_files/libs/clipboard/clipboard.min.js"></script>
<script src="LogReg2_files/libs/quarto-html/quarto.js"></script>
<script src="LogReg2_files/libs/quarto-html/popper.min.js"></script>
<script src="LogReg2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="LogReg2_files/libs/quarto-html/anchor.min.js"></script>
<link href="LogReg2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="LogReg2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="LogReg2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="LogReg2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="LogReg2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="logistic-regression-with-titanic-dataset" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression-with-titanic-dataset">Logistic Regression with Titanic Dataset</h2>
<section id="logistic-regression-part-2" class="level4">
<h4 class="anchored" data-anchor-id="logistic-regression-part-2">Logistic Regression (Part 2)</h4>
<p>In the last lecture we introduced logistic regression models. Recall that these models take the form:</p>
<p><span class="math inline">\(ln\left ( \frac{p}{1-p} \right) = \beta_0 + \beta_1 x_1 + … + \beta_n x_n\)</span></p>
<p>The output from a logistic regression model is (at least initially) an estimated probability, <span class="math inline">\(p\)</span>. In this lecture we consider the conversion of <span class="math inline">\(p\)</span> to class prediction.</p>
</section>
</section>
<section id="data-loading-cleaning-and-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-loading-cleaning-and-preparation">Data Loading, Cleaning, and Preparation</h2>
<p>Load Titanic Data from the titanic package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>titanic <span class="ot">=</span> titanic<span class="sc">::</span>titanic_train</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># factor conversion and recoding</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>titanic <span class="ot">=</span> titanic <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Survived =</span> <span class="fu">as_factor</span>(Survived)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Survived =</span> <span class="fu">fct_recode</span>(Survived, <span class="st">"No"</span> <span class="ot">=</span> <span class="st">"0"</span>, <span class="st">"Yes"</span> <span class="ot">=</span> <span class="st">"1"</span> )) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Pclass =</span> <span class="fu">as_factor</span>(Pclass)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Sex =</span> <span class="fu">as_factor</span>(Sex)) <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>PassengerId, <span class="sc">-</span>Name, <span class="sc">-</span>Ticket, <span class="sc">-</span>Fare, <span class="sc">-</span>Cabin, <span class="sc">-</span>Embarked)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># imputation</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co">#sets seed for random number generator</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>imp_age <span class="ot">=</span> <span class="fu">mice</span>(titanic, <span class="at">m=</span><span class="dv">5</span>, <span class="at">method=</span><span class="st">'pmm'</span>, <span class="at">printFlag=</span><span class="cn">FALSE</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#m is the number of imputations, 5 is a reasonable value as a default</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#pmm is "predictive mean matching" = imputation method for numeric data</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#printFlag reduces amount of output</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>titanic_complete <span class="ot">=</span> <span class="fu">complete</span>(imp_age) </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># view the cleaned and prepared data</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(titanic_complete)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Survived  Pclass      Sex           Age            SibSp      
 No :549   1:216   male  :577   Min.   : 0.42   Min.   :0.000  
 Yes:342   2:184   female:314   1st Qu.:19.00   1st Qu.:0.000  
           3:491                Median :28.00   Median :0.000  
                                Mean   :29.32   Mean   :0.523  
                                3rd Qu.:39.00   3rd Qu.:1.000  
                                Max.   :80.00   Max.   :8.000  
     Parch       
 Min.   :0.0000  
 1st Qu.:0.0000  
 Median :0.0000  
 Mean   :0.3816  
 3rd Qu.:0.0000  
 Max.   :6.0000  </code></pre>
</div>
</div>
</section>
<section id="a-logistic-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="a-logistic-regression-model">A Logistic Regression Model</h2>
<p>Last time we built the logistic regression model shown below. This model featured Pclass, Sex, and Age to predict Survived.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">=</span> <span class="fu">glm</span>(Survived <span class="sc">~</span> Pclass <span class="sc">+</span> Sex <span class="sc">+</span> Age , titanic_complete, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Survived ~ Pclass + Sex + Age, family = "binomial", 
    data = titanic_complete)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  1.001405   0.312100   3.209  0.00133 ** 
Pclass2     -1.178727   0.260274  -4.529 5.93e-06 ***
Pclass3     -2.459637   0.249514  -9.858  &lt; 2e-16 ***
Sexfemale    2.603539   0.187510  13.885  &lt; 2e-16 ***
Age         -0.033320   0.006525  -5.107 3.28e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1186.66  on 890  degrees of freedom
Residual deviance:  799.17  on 886  degrees of freedom
AIC: 809.17

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p><em>directionality of the slope</em></p>
<p>We then used this model to make predictions on several fake passengers.</p>
</section>
<section id="predictions-probabilities" class="level2">
<h2 class="anchored" data-anchor-id="predictions-probabilities">Predictions (Probabilities)</h2>
<p>Let’s make predictions on sample passenger. By setting type = “response” we are ensuring that we get a predicted probability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>newdata <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">Sex =</span> <span class="st">"male"</span>, <span class="at">Pclass =</span> <span class="st">"3"</span>, <span class="at">Age =</span> <span class="dv">44</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mod3, newdata, <span class="at">type=</span><span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         1 
0.05096464 </code></pre>
</div>
</div>
<p>If we were forced to classify this passenger as survived or died, what would we pick?</p>
<p>Another passenger.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>newdata <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">Sex =</span> <span class="st">"female"</span>, <span class="at">Pclass =</span> <span class="st">"1"</span>, <span class="at">Age =</span> <span class="dv">10</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mod3, newdata, <span class="at">type=</span><span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1 
0.9634466 </code></pre>
</div>
</div>
<p>If we were forced to classify this passenger as survived or died, what would we pick?</p>
<p>One more.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>newdata <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">Sex =</span> <span class="st">"male"</span>, <span class="at">Pclass =</span> <span class="st">"1"</span>, <span class="at">Age =</span> <span class="dv">29</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mod3, newdata, <span class="at">type=</span><span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1 
0.5087801 </code></pre>
</div>
</div>
<p>If we were forced to classify this passenger as survived or died, what would we pick?</p>
</section>
<section id="converting-to-class-predictions" class="level2">
<h2 class="anchored" data-anchor-id="converting-to-class-predictions">Converting to Class Predictions</h2>
<p>In some applications a probability is not enough. We want to assign an observation to one of the two classes in our response variable. To do this, we need to convert the logistic regression probability estimate with probability thresholds. The default probability threshold is 0.5.</p>
<ul>
<li><p>If an observation has a predicted probability greater than 0.5, we assign it to the positive class (Survived = “Yes” in the case of the Titanic data)</p></li>
<li><p>If an observation has a predicted probability less than 0.5, we assign it to the negative class (Survived = “No” in the case of the Titanic data)</p></li>
</ul>
<p>We start by producing predicted probabilities for each row in the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> <span class="fu">predict</span>(mod3, <span class="at">type=</span><span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Construct a “confusion matrix”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">=</span> <span class="fu">table</span>(predictions <span class="sc">&gt;</span> <span class="fl">0.5</span>, titanic_complete<span class="sc">$</span>Survived)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>table1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       
         No Yes
  FALSE 470 101
  TRUE   79 241</code></pre>
</div>
</div>
<p>Let’s talk about what this confusion matrix is telling us.</p>
<p><img src="conf_mat.png" class="img-fluid" width="526"></p>
<p>The <strong>rows</strong> in the confusion matrix correspond to our predictions. The “TRUE” corresponds to observations with a probability greater than 0.5. These would be predicted “Yes” values in the Titanic dataset. The “FALSE” corresponds to observations with an estimated probability less than 0.5. These would be “No” values in the Titanic dataset.</p>
<p>The <strong>columns</strong> in the confusion matrix correspond to the actual (observed) values in the dataset.</p>
<p>Where are the correct predictions in the confusion matrix? How about the incorrect ones?</p>
<section id="they-survived-and-predicted-that-they-would-not-survive." class="level3">
<h3 class="anchored" data-anchor-id="they-survived-and-predicted-that-they-would-not-survive."><strong>They survived and predicted that they would not survive.</strong></h3>
</section>
</section>
<section id="assessing-the-quality-of-predictions" class="level2">
<h2 class="anchored" data-anchor-id="assessing-the-quality-of-predictions">Assessing the Quality of Predictions</h2>
<p>We know that we can look at metrics like AIC and the significance of predictors to make some assessment of the quality of a logistic regression model. What other methods are there?</p>
<p><strong>Accuracy</strong> is a key measure of the quality of our predictions (once we have converted our probability estimates to class predictions). Accuracy is simply the number of correct predictions divided by the total number of predictions.</p>
<p>For the Titanic example above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nrow is a function that gives the number of rows in a dataset</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>(<span class="dv">470</span><span class="sc">+</span><span class="dv">241</span>)<span class="sc">/</span><span class="fu">nrow</span>(titanic_complete)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7979798</code></pre>
</div>
</div>
<p>We can also automate this a bit:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(table1[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">+</span> table1[<span class="dv">2</span>,<span class="dv">2</span>])<span class="sc">/</span><span class="fu">nrow</span>(titanic_complete)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7979798</code></pre>
</div>
</div>
<p>Is accuracy always a good measure of model quality? No!</p>
<p>What is the accuracy of the model that resulted in this confusion matrix?</p>
<p><em>99.9% of TSA, Fraud</em></p>
<p><img src="confmat2.png" class="img-fluid" width="531"></p>
<p>Is this is a good model? <strong>No, because 1 was left out.</strong> <em>(Tell you that you have X, but you don’t or tell you you don’t have X, but you do..)</em></p>
<p>Sacrifice accuracy for being more sensitive.</p>
<p><strong>Sensitivity</strong> is a measure of a model’s ability to accurately predict “positive” results. In the Titanic model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dv">241</span><span class="sc">/</span>(<span class="dv">241</span><span class="sc">+</span><span class="dv">101</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7046784</code></pre>
</div>
</div>
<p><strong>Specificity</strong> is a measure of a model’s ability to accurately predict “negative” results. In the Titanic model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="dv">470</span><span class="sc">/</span>(<span class="dv">470</span><span class="sc">+</span><span class="dv">79</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.856102</code></pre>
</div>
</div>
<p>Among accuracy, sensitivity, and specificity, which is most important?</p>
</section>
<section id="relationships-between-accuracy-sensitivity-and-specificity-threshold-selection" class="level2">
<h2 class="anchored" data-anchor-id="relationships-between-accuracy-sensitivity-and-specificity-threshold-selection">Relationships Between Accuracy, Sensitivity, and Specificity (Threshold Selection)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">=</span> <span class="fu">prediction</span>(predictions, titanic_complete<span class="sc">$</span>Survived)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">=</span> <span class="fu">performance</span>(pred,<span class="st">"tpr"</span>,<span class="st">"fpr"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf, <span class="at">colorize=</span><span class="cn">TRUE</span>, <span class="at">print.cutoffs.at=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>), <span class="at">text.adj=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>,<span class="fl">1.7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="LogReg2_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Y = <strong>Sensitivity</strong> <strong>:</strong> is a measure of a model’s ability to accurately predict “positive” results</p>
<p>X = <strong>Specificity :</strong> (1 - <strong>Specificity )</strong> is a measure of a model’s ability to accurately predict “negative” results</p>
<p>Let’s talk our way through this plot.</p>
<p>What’s the best threshold value? Once again, it depends!</p>
<p>Two popular options:</p>
<ul>
<li><p>Find the threshold that attempts to best balance sensitivity and specificity</p></li>
<li><p>Find the threshold that maximizes accuracy</p></li>
</ul>
<p>Balancing sensitivity and specificity:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>opt.cut <span class="ot">=</span> <span class="cf">function</span>(perf, pred){</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    cut.ind <span class="ot">=</span> <span class="fu">mapply</span>(<span class="at">FUN=</span><span class="cf">function</span>(x, y, p){</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>        d <span class="ot">=</span> (x <span class="sc">-</span> <span class="dv">0</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (y<span class="dv">-1</span>)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        ind <span class="ot">=</span> <span class="fu">which</span>(d <span class="sc">==</span> <span class="fu">min</span>(d))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(<span class="at">sensitivity =</span> y[[ind]], <span class="at">specificity =</span> <span class="dv">1</span><span class="sc">-</span>x[[ind]], </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">cutoff =</span> p[[ind]])</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    }, perf<span class="sc">@</span>x.values, perf<span class="sc">@</span>y.values, pred<span class="sc">@</span>cutoffs)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">opt.cut</span>(perf, pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 [,1]
sensitivity 0.7953216
specificity 0.7959927
cutoff      0.3908162</code></pre>
</div>
</div>
<p>Maximizing accuracy:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot accuracy as function of threshold</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>acc.perf <span class="ot">=</span> <span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"acc"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(acc.perf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="LogReg2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find best threshold to maximize accuracy</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>ind <span class="ot">=</span> <span class="fu">which.max</span>( <span class="fu">slot</span>(acc.perf, <span class="st">"y.values"</span>)[[<span class="dv">1</span>]] )</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>acc <span class="ot">=</span> <span class="fu">slot</span>(acc.perf, <span class="st">"y.values"</span>)[[<span class="dv">1</span>]][ind]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>cutoff <span class="ot">=</span> <span class="fu">slot</span>(acc.perf, <span class="st">"x.values"</span>)[[<span class="dv">1</span>]][ind]</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">c</span>(<span class="at">accuracy=</span> acc, <span class="at">cutoff =</span> cutoff))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  accuracy cutoff.828 
 0.8058361  0.4475333 </code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>